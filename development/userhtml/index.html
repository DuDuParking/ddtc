<!DOCTYPE html>
<html>
<head>
    <title>嘟嘟停车</title>
    <meta charset="UTF-8">
    <script src="../golba_rs/js/sys.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no" />

    <link rel="stylesheet" href="../golba_rs/css/mui.min.css">
    <link rel="stylesheet" href="../golba_rs/css/animate.css">
    <link rel="stylesheet" href="./css/main.css">
    <style></style>
</head>
<body>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?aa83b44255e0841ab8bc2d46302e84cf";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>
    /**
     *     入口链接点击跟踪：
             提示语中的链接：（分母：公共号的关注人数－A、活跃人数－A0）
                 附近空车位：A1
                 搜索地址：A2
                 停车缴费：A3
             菜单中的链接：（分母：公共号的关注人数、活跃人数）
                 附近：B1
                 搜索：B2
                 缴费：B3
                 我的订单：B4
                 我的卡券：B5
                 我的信息：B6
         主体下单流程：
             选择停车场：（分母：附近停车场列表页面－C、目的地停车场列表页面－C0）
                 列表中停车场全是满的状态：C1
                 列表中1000米范围内有可预定的停车场：C2
                 列表中1000～2000米范围内有可预定的停车场：C3
                 范围内无停车场的状态：C4
             预付下单：（分母：预付下单界面－D）
                 还没车牌的状态：D1
                 没有抵用劵的情况：D2
                 修改车牌号的情况：D3
                 点击导航按钮：D4
                 确认预付按钮点击：D5
                 支付成功：D6
             缴费结清界面：（分母：缴费结清页面－E）
                 不需要再缴费的状态：E1
                 需要缴费结清的状态：E2
                 拨打管理员电话：E3
     * @type {*}
     */
    window.TongjiObj = (function(){
        var obj = {
            /**
             *  category：要监控的目标的类型名称，通常是同一组目标的名字，比如"视频"、"音乐"、"软件"、"游戏"等等。该项必选。
                action：用户跟目标交互的行为，如"播放"、"暂停"、"下载"等等。该项必选。
                opt_label：事件的一些额外信息，通常可以是歌曲的名称、软件的名称、链接的名称等等。该项可选。
                opt_value：事件的一些数值信息，比如权重、时长、价格等等，在报表中可以看到其平均值等数据。该项可选。
             */
            push:function(category, action, opt_label, opt_value){
                setTimeout(function(){
                    _hmt.push(['_trackEvent', category, action, opt_label || 0, opt_value] || 0);
                    console.log('_hmt.push','_trackEvent', category, action, opt_label, opt_value);
                });
            }
            ,clickLink:function(action){          //模块链接
                this.push('B','B_'+action);
            }
            ,A:function(action){        //附近空车位：A1搜索地址：A2停车缴费：A3,
                this.push('A', action);
            }
            ,
            /**
             * 列表中停车场全是满的状态：C1
             * 列表中1000米范围内有可预定的停车场：C2
             * 列表中1000～2000米范围内有可预定的停车场：C3
             * 范围内无停车场的状态：C4
             * 范围内无停车场的状态：C4
             * @param active
             * @constructor
             */
            C:function(action){        //
                this.push('C', action);
            }
            ,
            /**
             *     还没车牌的状态：D1
                 没有抵用劵的情况：D2
                 修改车牌号的情况：D3
                 点击导航按钮：D4
                 确认预付按钮点击：D5
                 支付成功：D6
             * @param action
             * @constructor
             */
            D:function(action){
                this.push('D', action);
            }
            ,
            /**
            *   不需要再缴费的状态：E1
                 需要缴费结清的状态：E2
                 拨打管理员电话：E3
             * @constructor
             */
            E:function(action){
                this.push('E', action);
            }
        }
        return obj;
    })();
</script>
<div class="bodypage">
    <div id="main_contaion" class="pagecontainer">
        <div id="canvaswrap" class="mui-off-canvas-wrap page">
    	<div class="mui-inner-wrap">
    		<div class="mui-content mytabs">
                <div id="tabbar-with-user" class="mui-control-content"   name='login'>
                    <h3 class="copyright">Copyright@@2015</h3>
                </div>
                <div id="tabbar-with-collection" class="mui-control-content"   name='map'>
                    <h3 class="copyright">Copyright@@2015</h3>
                </div>
                <div id="tabbar-with-in" class="mui-control-content"  name='myorder'>
                    <h3 class="copyright">Copyright@@2015</h3>
                </div>
                <div id="tabbar-with-out" class="mui-control-content"   name='myorderdetail'>
                    <h3 class="copyright">Copyright@@2015</h3>
                </div>
                <div class="mui-control-content"   name='userinfo'>
                    <h3 class="copyright">Copyright@@2015</h3>
                </div>
                <div class="mui-control-content"   name='mapfull'>
                    <h3 class="copyright">Copyright@@2015</h3>
                </div>
                <div class="mui-control-content"   name='coupon'>
                    <h3 class="copyright">Copyright@@2015</h3>
                </div>
    		</div>
    		<!-- off-canvas backdrop -->
    	</div>
    </div>
    </div>

    <div  class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none"><!--list-->
        <div class="page">
        </div>
    </div>
    <div  class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none"><!--list-->
            <div class="page">
            </div>
        </div>
    <div  class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none"><!--list-->
            <div class="page">
            </div>
        </div>
    <div  class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none"><!--list-->
            <div class="page">
            </div>
        </div>
    <div  class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none"><!--list-->
            <div class="page">
            </div>
        </div>
    <div id="tophead"  class="pagecontainer" animname='anim_rightin' style="display: none"><!--list-->
        <header class="mui-bar mui-bar-nav">
            <a name='btclose' class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
            <h1 class="mui-title"></h1>
        </header>
    </div>

    <div id="topheardpagecontainer"  class="pagecontainer topheardpagecontainer" animname='anim_rightin' style="display: none"><!--list-->
        <header class="mui-bar mui-bar-nav mui-bar-top">
            <a name='btupclose' class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
            <h1 class="mui-title"></h1>
            <button class="mui-btn mui-btn-link mui-btn-nav mui-pull-right main-icon-lit">
             <a class="mui-icon mui-icon-gear mui-pull-right"></a>
            </button>
        </header>
    </div>
    <div id="pop_pagecontaion" class="pagecontainer" style="display: none">
        <!--<header class="mui-bar mui-bar-top">-->
            <!--<button name='btclose' class="mui-action-back mui-btn mui-pull-left">退出</button>-->
            <!--<h1 class="mui-title"></h1>-->
            <!--<button name='btcloseok' class="mui-action-back mui-btn mui-pull-right">确定</button>-->
        <!--</header>-->
        <div class="page" style="background-color:#fff">
        </div>
    </div>
    <div id="coupon_pagecontaion" class="pagecontainer" style="display: none">
        <div class="page" style="background-color:#fff">
        </div>
    </div>
    <div id="jiesuan_pagecontaion" class="pagecontainer" style="display: none">
        <div class="page" style="background-color:#fff">
        </div>
    </div>
    <div id="reg_pagecontaion" class="pagecontainer" style="display: none">
        <div class="page" style="background-color:#fff">
        </div>
    </div>
    <div id="top_menu" class="pagecontainer" style=" display: none">
        <div class="mui-popover mui-active" style="display: block;">
            <ul class="mui-table-view" name='list'>
                <li class="mui-table-view-cell" name='title'>菜单1:</li>
                <li class="mui-table-view-cell" name='title'>菜单1:</li>
                <li class="mui-table-view-cell" name='title'>菜单1:</li>
            </ul>
            <ul class="template"><li class="mui-table-view-cell" name='title'>菜单1:</li></ul>
        </div>
        <div name='make' class="mui-backdrop mui-active"></div>
    </div>
    <div id="reg_dialog_pagecontainer" class="pagecontainer" style=" display: none;z-index: 500">
        <div name="loginpanel" class="mui-slider-item mui-control-content mui-active loginpanel  animated zoomIn">
            <div class="mui-input-row reg-user">
                <h1 class="iconrow">嘟嘟停车</h1>
                <span name='btclose' class="mui-icon mui-icon-close"></span>
                <hr>
                <p name='msg'>首次使用嘟嘟停车需要注册你的手机号和车牌号</p>

                <input name="userpanel_phone" type="text" class="mui-input-clear" placeholder="请输入您的手机号" >
                <br/>
                <input style="display: none" name="userpanel_chepai" type="text" class="mui-input-clear" placeholder="请输入您的车牌" >
                <button name="btreg" class="mui-btn mui-btn-warning mui-btn-block">确认</button>
            </div>
        </div>
        <div name='make' class="mui-backdrop mui-active"></div>
    </div>
    <div id="alert_pagecontainer" class="pagecontainer" style=" display: none">
        <div class="mui-popover mui-active" style="display: block;">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell" name='title'>错误信息:</li>
                <li class="mui-table-view-cell" name='msg'>错误内容</li>
            </ul>
        </div>
        <div name='make' class="mui-backdrop mui-active"></div>
    </div>
    <div id="confirm_pagecontainer" class="pagecontainer" style=" display: none;z-index: 500">
        <div class="mui-popover mui-active" style="display: block;">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell title" name='title'>操作确认:</li>
                <li class="mui-table-view-cell msg" name='msg'>内容</li>
                <li class="mui-table-view-cell">
                    <table style="width: 80%">
                        <tr>
                            <td><div class="mui-btn mui-btn-red  mui-pull-right" name="btcancel">取 消</div></td>
                            <td><div class="mui-btn mui-btn-success  mui-pull-right" name="btok">确 认</div></td>
                        </tr>
                    </table>
                </li>
            </ul>
        </div>
        <div name='make' class="mui-backdrop mui-active"></div>
    </div>


<table id="loading" class="loading" style="display: none">
    <tr align='middel'>
        <td style="text-align: center"><div><div></div></div><br>
            <a name="bt" style="color: #16A7DE;text-shadow: 1px 0px 0px #fff, -1px 0px 0px #fff, 0px 1px 0px #fff, 0px -1px 0px #fff;">数据加载中...</a></td>
    </tr>
</table>
<div id="startpage" class="startpage">
    嘟嘟停车
    <p class="mui-bar-footer">duduche.me</p>
</div>
</div>
<div class="template">

</div>
<div class="template">
    <div class="mapPluginInit_mk1" name="map_control_home"></div>
</div>
</body>

<script src="../golba_rs/js/jquery-1.9.1.min.js"></script>

<script src="../golba_rs/js/iscroll.js" __del__></script>
<script src="./js/cfg.js" __del__></script>
<script src="./js/utils.js" __del__></script>
<script src="./js/manager.js" __del__></script>
<script src="./js/ajax.js" __del__></script>
<script src="./js/view.js" __del__></script>
<script src="./js/map_plugin.js" __del__></script>

<script src="./views/map/map.js" __del__></script>
<script src="./views/mapfull/mapfull.js" __del__></script>
<script src="./views/daohang/daohang.js" __del__></script>
<script src="./views/searchmap/searchmap.js" __del__></script>
<script src="./views/myorder/myorder.js" __del__></script>
<script src="./views/myorderdetail/myorderdetail.js" __del__></script>
<script src="./views/reg/reg.js" __del__></script>
<script src="./views/orderpay/orderpay.js" __del__></script>
<script src="./views/userinfo/userinfo.js" __del__></script>
<script src="./views/coupon/coupon.js" __del__></script>
<script src="./views/couponget/couponget.js" __del__></script>
<script src="./views/gaodedaohang/gaodedaohang.js" __del__></script>
<script src="./views/parkinfo/parkinfo.js" __del__></script>

<script __alljs__></script>


<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
    document.ontouchmove = function(e){     //文档禁止 touchmove事件
        return false;
    };
    $(function(){
        window.sysmanager.init();


        //tab
        var tabcontrols = $('[name=tabscontrol]');
        var tabcards =  $('.mytabs>div');
        var tabs = window.testtabs = utils.jq.initTab(tabcontrols,tabcards,'  mui-active');
        var nowview = null;

        tabs.activeHandle[6] = tabs.activeHandle[5] = tabs.activeHandle[4] = tabs.activeHandle[3] =tabs.activeHandle[2] = tabs.activeHandle[1] = function(context){

            viewManager.viewroot('views/');
            var viewname = context.attr('name');
            var view = viewManager.loadview(viewname,function(v){
                context.empty();
                v.renderer(context);
                if(nowview){
                    nowview.obj.close();
                }
                nowview = v;
            });
        }

        function initstart(){
            var model = utils.tools.getUrlParam('m');
            switch (model){
                case 'myorder':
                    tabs.activeTab(2);
                    break;
                case 'myjiesuan':
                    tabs.activeTab(3);
                    break;
                case 'userinfo':
                    tabs.activeTab(4);
                    break;
                case 'mapfull':
                    tabs.activeTab(5);
                    break;
                case 'coupon':
                    tabs.activeTab(6);
                    break;
                case "map":
                case "mapsearch":
                default :
                    tabs.activeTab(1);
                    break;
            }
            $('#startpage').hide();
        }

        function type_1(){
            sysmanager.checkLogin(function(islogin){
                if(islogin){
                    initstart();
                }else{
                    sysmanager.loadpage('views/', 'reg', $('#reg_pagecontaion'),null, function(view){
                        view.obj.onclose = function(){
                            initstart();
                        }
                    });
                }

            });
            $('#startpage').hide();
        }

        function type_2(){
            sysmanager.loadpage('views/', 'reg', $('#reg_pagecontaion'),null, function(view){
                view.obj.onclose = function(){
                    initstart();
                }
            });
            $('#startpage').hide();
        }
        function type_3(){      //已经注册
            var userinfo = {
                uid:utils.tools.getUrlParam('uid')
                ,uuid:utils.tools.getUrlParam('uuid')
            }
            window.myajax.userinfo(userinfo);
            setTimeout(function(){
                initstart();
            });
            $('#startpage').hide();
        }
        function type_10(){     //领取红包
            $('title').html('嘟嘟停车抢红包啦');
            var code = utils.tools.getUrlParam('hcode');
            var fromid = utils.tools.getUrlParam('fromid') || 0;
            sysmanager.couponUI(code,fromid);
            $('#startpage').hide();
        }

        var type = utils.tools.getUrlParam('type') || '1';
        var openid = utils.tools.getUrlParam('openid');

        switch (type){
            case '1':       //非openid模式
                    type_1();
                break;
            case '2':       //openid未注册
                    type_2();
                break;
            case '3':       //openid注册
                    type_3();
                break;
            case '10':      //领取红包
                type_10();
                break;
        }



    });

</script>
<script>
    window.Myweixinobj = (function(){

        var title = ''; // 分享标题
        var desc  =  ''; // 分享描述
        var linkUrl = ''; // 分享链接
        var imgUrl = ''; // 分享图标
        var fenxiangcallback = null;

       var obj = {
           init:function(_title,_desc,_link,_imgUrl, _fenxiangcallback){      //初始化分享的内容
               title = _title;
               desc = _desc;
               linkUrl = _link;
               imgUrl = _imgUrl;
               fenxiangcallback = _fenxiangcallback;
           }
           ,initFenxiang:function(){
               var me = this;
               wx.ready(function () {
                // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。

                    wx.checkJsApi({
                      jsApiList: [
                        'checkJsApi',
                        'onMenuShareTimeline',
                        'onMenuShareAppMessage',
                        'onMenuShareQQ',
                        'onMenuShareWeibo'
                      ],
                      success: function (res) {
                        //alert(JSON.stringify(res));
                      }
                    });
                    me.initBind();

                });

                wx.error(function (res) {
                    // config信息验证失败会执行error函数，如签名过期导致验证失败，具体错误信息可以打开config的debug模式查看，也可以在返回的res参数中查看，对于SPA可以在这里更新签名。
                    alert(res.errMsg);
                });
           }
           ,initBind:function(){
               //分享给朋友
                           wx.onMenuShareAppMessage({
                             title: title,
                             desc: desc,
                             link: linkUrl,
                             imgUrl: imgUrl,
                             trigger: function (res) {
                               //alert('用户点击发送给朋友');
                             },
                             success: function (res) {
                               //alert('已分享朋友');
                               fenxiangcallback && fenxiangcallback(); //分享统计发送
                             },
                             cancel: function (res) {
                               //alert('已取消');
                             },
                             fail: function (res) {
                               //alert(JSON.stringify(res));
                             }
                           });

                           //分享到朋友圈
                           wx.onMenuShareTimeline({
                             title: desc,
                             link: linkUrl,
                             imgUrl: imgUrl,
                             trigger: function (res) {
                               //alert('用户点击分享到朋友圈');
                             },
                             success: function (res) {
                               //alert('已分享朋友圈');
                                 fenxiangcallback && fenxiangcallback(); //分享统计发送
                             },
                             cancel: function (res) {
                               //alert('已取消');
                             },
                             fail: function (res) {
                               //alert(JSON.stringify(res));
                             }
                           });

                           //分享到QQ
                           wx.onMenuShareQQ({
                             title: title,
                             desc: desc,
                             link: linkUrl,
                             imgUrl: imgUrl,
                             trigger: function (res) {
                               //alert('用户点击分享到QQ');
                             },
                             complete: function (res) {
                               //alert(JSON.stringify(res));
                             },
                             success: function (res) {
                               //alert('已分享qq');
                                 fenxiangcallback && fenxiangcallback(); //分享统计发送
                             },
                             cancel: function (res) {
                               //alert('已取消');
                             },
                             fail: function (res) {
                               //alert(JSON.stringify(res));
                             }
                           });
           }
           ,config:function(cfg){
               /**
                * wx.config({
                        debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                        appId: '', // 必填，公众号的唯一标识
                        timestamp:'' , // 必填，生成签名的时间戳
                        nonceStr: '', // 必填，生成签名的随机串
                        signature: '',// 必填，签名，见附录1
                        jsApiList: ['onMenuShareTimeline','onMenuShareAppMessage','onMenuShareQQ','onMenuShareWeibo'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                    });
                */
               wx.config(cfg);
               this.initFenxiang();
           }
           ,setDesc:function(_desc){
               desc = _desc;
               return this;
           }
           ,setTitle:function(_title){
               title = _title;
               return this;
           }
       }
        return obj;
    })();
</script>
<script>
    var urlPath = (function() {
         var a = window.location.origin;
         var d = window.location.pathname.split("/");
         var c = a + "/";
         for (var b = 0; b < d.length - 1; b++) {
             if (d[b]) {
                 c += d[b] + "/"
             }
         }
         return c
     })();

    function geswxcfg(fn){
        window.myajax.get('weixin','getJsConfig',{url:window.location.href}, function(result){
            fn && fn(result.data);
        }, null, false);
    }
    function wxinit(cfginfo){
        /**
         * appId: "wx7402a94935807c76"
         * nonceStr: "OFXLWLTGSayHCOKL"
         * signature: "64f97be21281babd0728b683ef0b01934e0d4776"
         * timestamp: 1427710434
         * @type {*|String}
         */

        var type = utils.tools.getUrlParam('type') || '1';
        if('10' != type){
            var imgUrl = urlPath+'/img/icon.png';
             var lineLink = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxd417c2e70f817f89&redirect_uri=http%3a%2f%2fdriver.duduche.me%2fdriver.php%2fhome%2fweixin%2fmenuCallBack%2f&response_type=code&scope=snsapi_base&state=near#wechat_redirect';
             var descContent = "我在用嘟嘟停车,停车好方便.";
             var shareTitle = '嘟嘟停车';
             Myweixinobj.init(shareTitle, descContent, lineLink, imgUrl, function(){
             });

             //封装微信 wx.cfg
             Myweixinobj.config(

                     {
                        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来
                        appId: cfginfo.appId, // 必填，公众号的唯一标识
                        timestamp: cfginfo.timestamp, // 必填，生成签名的时间戳
                        nonceStr: cfginfo.nonceStr, // 必填，生成签名的随机串
                        signature: cfginfo.signature,// 必填，签名
                        jsApiList: [
                            'checkJsApi',
                            'onMenuShareTimeline',
                            'onMenuShareAppMessage',
                            'onMenuShareQQ',
                            'onMenuShareWeibo'
                        ] // 必填，需要使用的JS接口列表
                    }

             );
        }else{
            var hcode = utils.tools.getUrlParam('hcode') || '1';
            var fromid = utils.tools.getUrlParam('fromid') || '0';
            var imgUrl = urlPath+'/img/hongbao/fenxiang.jpg';
            var lineLink = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxd417c2e70f817f89&redirect_uri={myurl}&response_type=code&scope=snsapi_base#wechat_redirect';
            var myurl = 'http://driver.duduche.me/driver.php/home/weixin/giftCallBack/type/10/hcode/{hcode}/fromid/{fromid}/';
            myurl = myurl.replace('{hcode}', hcode).replace('{fromid}', fromid);
            myurl = encodeURIComponent(myurl);
            lineLink = lineLink.replace('{myurl}', myurl);
             var descContent = "开车的小伙伴们,快来领嘟嘟停车红包吧!";
             var shareTitle = '嘟嘟停车发红包啦';
             Myweixinobj.init(shareTitle, descContent, lineLink, imgUrl, function(){

             });
             //封装微信 wx.cfg
             Myweixinobj.config({
                        debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来
                        appId: cfginfo.appId, // 必填，公众号的唯一标识
                        timestamp: cfginfo.timestamp, // 必填，生成签名的时间戳
                        nonceStr: cfginfo.nonceStr, // 必填，生成签名的随机串
                        signature: cfginfo.signature,// 必填，签名
                        jsApiList: [
                            'checkJsApi',
                            'onMenuShareTimeline',
                            'onMenuShareAppMessage',
                            'onMenuShareQQ',
                            'onMenuShareWeibo'
                        ] // 必填，需要使用的JS接口列表
                    }

             );

        }
    }
    geswxcfg(function(data){
       wxinit(data);
    });
</script>
</html>