<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script>
        /**
         * Created by Common on 14-9-12.
         */
        var deviceAgent = navigator.userAgent.toLowerCase();
        var agentID = deviceAgent.match(/(iphone|ipod|ipad|android)/) || '';
        var mobile = {
            iphone:agentID.indexOf("iphone")>=0
            ,android:agentID.indexOf("android")>=0
            ,ipad:agentID.indexOf("ipad")>=0
            ,ipad:agentID.indexOf("ipod")>=0
        }
        if(mobile.iphone){
            //alert('iphone');
            document.write('<meta name="viewport" content="width=device-width, initial-scale=01, user-scalable=0,minimal-ui">');
        }else if(mobile.android){
            //alert('android');
            document.write('<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=0">');
            //document.write('<meta name="viewport" content="target-densitydpi=device-dpi">');
        }else{
            //alert('other');
            document.write('<meta name="viewport" content="width=device-width, initial-scale=0.5, user-scalable=0,minimal-ui">');
        }
    </script>
    <style>
        html,body{
            margin: 0;
            padding: 0;
            height: 100%;
        }
        body{

        }
        .if1{
            width: 100%;
            height: 100%;
        }
        #offlinePage{
            position: absolute;
            width: 100%;
            height: 100%;
            left: 0;
            top: 0;
            font-size: 25px;
            text-align: center;
            line-height: 300px;
            z-index: 10000;
            background-image: url(../img/icon.png);
            background-repeat: no-repeat;
            background-position: center center;
            background-color: #226BD1;
            color: #fff;
        }
        #offlinePage>p{
            line-height: 25px;
            font-size: 16px;
            position: absolute;
            width: 100%;
            bottom: 50%;
        }

    </style>
</head>
<body>
<iframe id="appiframe" class="if1" border='0' src=""></iframe>
<div id="offlinePage">
    <h3>未监测到网络信号！</h3>
    <p>
        请确保网络连接正常，系统稍后自动重试。
    <p>
</div>
<script>

    function sendInfoToAnotherDomain(info){
        var iframe=window.frames[0];
        iframe.postMessage(info,'http://duduche.me');           //限制域名
    }

</script>

<script type="text/javascript" src="cordova.js"></script>
<script>

var app = {
    // Application Constructor
    initialize: function() {
        this.bindEvents();
    },
    // Bind Event Listeners
    //
    // Bind any events that are required on startup. Common events are:
    // 'load', 'deviceready', 'offline', and 'online'.
    bindEvents: function() {
        document.addEventListener('deviceready', this.onDeviceReady, false);
    },
    // deviceready Event Handler
    //
    // The scope of 'this' is the event. In order to call the 'receivedEvent'
    // function, we must explicitly call 'app.receivedEvent(...);'
    onDeviceReady: function() {
        //初始化device
        device.onPushID = app.onPushID;
        device.onMsgData = app.onMsgData;

        this.onMyEVENT();
        //app.receivedEvent('deviceready');
    }
    ,onMyEVENT:function(){
        document.addEventListener("backbutton", function(e){
            setTimeout(function(){
                sendInfoToAnotherDomain('{"quit":"1"}');
            });
            //navigator.app.exitApp();
            //navigator.app.backHistory()
        }, false);

        //网络检测

        document.addEventListener("offline", function(){
            offlineProcess(false);
        }, false);
        document.addEventListener("online", function(){
            offlineProcess(true);
        }, false);
        var stateisLine = null;     //当前在线状态

        var offlineProcess = window.offlineProcess = function(isLine){    //在线处理  isLine 是否在线
            if(isLine == stateisLine){
                return;
            }
            var offlinePage = document.getElementById('offlinePage');
            var appiframe = document.getElementById('appiframe');
            if(isLine){
                offlinePage.style.display = 'none';
                var src = 'http://duduche.me/html/secenhtml/index.html?'+new Date;
                appiframe.style.display = 'block';
                appiframe.src = src ;
            }else{
                appiframe.style.display = 'none';
                offlinePage.style.display = 'block';
            }
            stateisLine = isLine;
        }

        var mycheckConnection = window.mycheckConnection = function() {
            if(navigator.connection.type == Connection.NONE){
                offlineProcess(false);
            }else{
                offlineProcess(true);
            }

        }
        setTimeout(function(){
            mycheckConnection();
        });
    }
    ,
    // Update DOM on a Received Event
    /**
    receivedEvent: function(id) {
        var parentElement = document.getElementById(id);
        var listeningElement = parentElement.querySelector('.listening');
        var receivedElement = parentElement.querySelector('.received');

        listeningElement.setAttribute('style', 'display:none;');
        receivedElement.setAttribute('style', 'display:block;');

        receivedElement.innerHTML = 'Received Event: ' + id;

        console.log('Received Event: ' + id);
    },*/
    onPushID: function(data) {
        /**
        var parentElement = document.getElementById('deviceready');
        var listeningElement = parentElement.querySelector('.listening');
        var receivedElement = parentElement.querySelector('.received');

        listeningElement.setAttribute('style', 'display:none;');
        receivedElement.setAttribute('style', 'display:block;');
        receivedElement.innerHTML = 'PushID: ' + data;

        console.log('PushID: ' + data);
         */
        //setTimeout(function(){window.PushManager.PUSH_ID(data);});
        var obj = {
            pushid:data
        }
        setTimeout(function(){
            sendInfoToAnotherDomain(JSON.stringify(obj));
        });
    },
    onMsgData: function(data) {
        /**
    var parentElement = document.getElementById('deviceready');
        var listeningElement = parentElement.querySelector('.listening');
        var receivedElement = parentElement.querySelector('.received');

        listeningElement.setAttribute('style', 'display:none;');
        receivedElement.setAttribute('style', 'display:block;');
    receivedElement.innerHTML = 'MsgData: ' + data;

    console.log('MsgData: ' + data);
         */
        //setTimeout(function(){window.PushManager.PUSH_MSG(data);});
        setTimeout(function(){
            sendInfoToAnotherDomain(data);
        });
    }
};

app.initialize();
</script>
</body>
</html>