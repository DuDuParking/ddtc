<!DOCTYPE html>
<html>
<head>
    <title>嘟嘟停车现场</title>
    <meta charset="UTF-8">
    <script src="../golba_rs/js/sys.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <link rel="stylesheet" href="../golba_rs/css/mui.min.css">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" href="../golba_rs/css/animate.css">

</head>
<body>
<div class="bodypage">
    <div id="main_contaion" class="pagecontainer">
        <div id="canvaswrap" class="mui-off-canvas-wrap page">
    	<div class="mui-inner-wrap">
    		<nav class="mui-bar mui-bar-tab" style="position: fixed" id="mybar">
                <a class="mui-tab-item" id="btoffCanvas" href="javascript:;" name="tabscontrol">
                    <span class="mui-icon mui-icon-contact"></span>
                </a>
                <a class="mui-tab-item" href="javascript:;" name="tabscontrol">
                    <span class="mui-icon mui-icon-home"></span>
                </a>
                <a class="mui-tab-item  mui-active" href="javascript:;"  name="tabscontrol">
                    <span class="mui-icon mui-icon-download"></span>
                </a>
                <a class="mui-tab-item" href="javascript:;"  name="tabscontrol">
                    <span class="mui-icon mui-icon-upload"></span>
                </a>
            </nav>
    		<aside id="offCanvas" class="mui-off-canvas-left">
                <div class="page">
                    会员中心
                </div>
    		</aside>
    		<div class="mui-content mytabs">
                <div id="tabbar-with-user" class="mui-control-content"   name='login'>
                        <h3>登录</h3>
                </div>
                <div id="tabbar-with-collection" class="mui-control-content"   name='user'>
                		<h3>主页</h3>
                </div>
                <div id="tabbar-with-in" class="mui-control-content"  name='secen_in'>
                    <h3>入场管理</h3>
                </div>
                <div id="tabbar-with-out" class="mui-control-content"   name='secen_out'>
                    <h3>出场管理</h3>
                </div>
    		</div>
    		<!-- off-canvas backdrop -->
    	</div>
    </div>
    </div>

    <div  class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none"><!--list-->
        <div class="page">
        </div>
    </div>
    <div  class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none"><!--list-->
            <div class="page">
            </div>
        </div>
    <div  class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none"><!--list-->
            <div class="page">
            </div>
        </div>
    <div  class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none"><!--list-->
            <div class="page">
            </div>
        </div>
    <div  class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none"><!--list-->
            <div class="page">
            </div>
        </div>
    <div id="tophead"  class="pagecontainer" animname='anim_rightin' style="display: none"><!--list-->
        <header class="mui-bar mui-bar-nav">
            <a name='btclose' class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
            <h1 class="mui-title"></h1>
        </header>
    </div>

    <div id="topheardpagecontainer"  class="pagecontainer topheardpagecontainer" animname='anim_rightin' style="display: none"><!--list-->
        <header class="mui-bar mui-bar-nav mui-bar-top">
            <a name='btupclose' class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
            <h1 class="mui-title"></h1>
            <button class="mui-btn mui-btn-link mui-btn-nav mui-pull-right main-icon-lit">
             <a class="mui-icon mui-icon-gear mui-pull-right"></a>
            </button>
        </header>
    </div>

    <div id="pop_pagecontaion" class="pagecontainer" style="display: none">
        <header class="mui-bar mui-bar-top">
            <button name='btclose' class="mui-action-back mui-btn mui-pull-left">退出</button>
            <h1 class="mui-title"></h1>
            <button name='btcloseok' class="mui-action-back mui-btn mui-pull-right">确定</button>
        </header>
        <div class="page" style="background-color:#fff">
        </div>
    </div>
    <div id="sence_in_pagecontaion" class="pagecontainer" style="display: none;z-index: 199">
        <header class="mui-bar mui-bar-top">
            <a name='btclose_sence_in' class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
            <h1 class="mui-title">入场管理</h1>
        </header>
        <div class="page" style="background-color:#fff;padding-top: 44px;">
        </div>
    </div>
    <div id="sence_out_pagecontaion" class="pagecontainer" style="display: none;z-index: 200">
        <header class="mui-bar mui-bar-top">
            <a name='btclose_sence_out' class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
            <h1 class="mui-title">离场管理</h1>
        </header>
        <div class="page" style="background-color:#fff;padding-top: 44px;">
        </div>
    </div>
    <div id="login_pagecontaion" class="pagecontainer" style="display: none;z-index: 400">
        <div class="page" style="background-color:#fff;"></div>
    </div>
    <div id="top_menu" class="pagecontainer" style=" display: none;z-index: 400">
        <div class="mui-popover mui-active" style="display: block;">
            <ul class="mui-table-view" name='list'>
                <li class="mui-table-view-cell" name='title'>菜单1:</li>
                <li class="mui-table-view-cell" name='title'>菜单1:</li>
                <li class="mui-table-view-cell" name='title'>菜单1:</li>
            </ul>
            <ul class="template"><li class="mui-table-view-cell" name='title'>菜单1:</li></ul>
        </div>
        <div name='make' class="mui-backdrop mui-active"></div>
    </div>
    <div id="alert_pagecontainer" class="pagecontainer" style=" display: none;z-index: 500">
        <div class="mui-popover mui-active" style="display: block;">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell" name='title'>错误信息:</li>
                <li class="mui-table-view-cell" name='msg'>错误内容</li>
            </ul>
        </div>
        <div name='make' class="mui-backdrop mui-active"></div>
    </div>

<table id="loading" class="loading" style="display: none">
    <tr align='middel'>
        <td style="text-align: center"><a><span class="mui-icon mui-icon-spinner mui-spin"></span></a><a name="bt" style="display: inline-block;padding-left: 5px">当前网路不给力</a></td>
    </tr>
</table>
    <div id="startpage" class="startpage">嘟嘟停车</div>
</div>
</body>
<script src="../golba_rs/js/iscroll.js"></script>
<!--<script src="../golba_rs/js/jquery-1.9.1.min.js"></script>-->
<script src="../golba_rs/js/require.js" data-main="./js/require_main"></script>
<!--<script src="./views/login/login.js"></script>-->

<script>
    document.ontouchmove = function(e){return false;}; //文档禁止 touchmove事件
    window.myinit = function($, utils, ajax,viewmanager){

        //tab
        var tabcontrols = $('[name=tabscontrol]');
        var tabcards =  $('.mytabs>div');
        var tabs = window.testtabs = utils.jq.initTab(tabcontrols,tabcards,'  mui-active');
        var nowview = null;

        tabs.activeHandle[5] = tabs.activeHandle[4] = tabs.activeHandle[3] =tabs.activeHandle[2] = tabs.activeHandle[1] = function(context){
            viewmanager.viewroot('views/maintabs/');
            var viewname = context.attr('name');
            var view = viewmanager.loadview(viewname,function(v){
                context.empty();
                v.renderer(context);
                if(nowview){
                    nowview.obj.close();
                }
                nowview = v;
            });
        }
        tabs.activeTab(1);
        setTimeout(function(){
            //btoffCanvas.aclick();
            utils.sys.Pushinit();
            $('#startpage').hide();
        },1e3*2);

//        var btoffCanvas = $('#btoffCanvas').aclick(function(){
//            utils.sys.loadpage('views/', 'login', null, '用户中心',function(v){
//                setTimeout(function(){
//                    $('#startpage').hide();
//                },1e3);
//                v.obj.onclose = function(){
//                    var userinfo = ajax.userinfo();
//                    if(userinfo){
//                        console.log(userinfo);
//                    }
//                    tabs.activeTab(1);
//                }
//            });
//        });

//        sysmanager.checkLogin(function(islogin){
//            if(islogin){
//                initstart();
//            }else{
//                sysmanager.loadpage('views/', 'reg', $('#reg_pagecontaion'),null, function(view){
//                    view.obj.onclose = function(){
//                        initstart();
//                    }
//                });
//            }
//            $('#startpage').hide();
//        });
    }
</script>
<script>
    //接受消息处理
        (function receiveInfoFromAnotherDomain(){

            (function(){
                var initializing = false, fnTest = /xyz/.test(function(){xyz;}) ? /\bparent\b/ : /.*/;
                var Class = function(){};
                Class.extend = function(prop) {
                        var parent = this.prototype;

                        initializing = true;
                        var prototype = new this();
                        initializing = false;

                        for( var name in prop ) {
                            if(
                                typeof(prop[name]) == "function" &&
                                    typeof(parent[name]) == "function" &&
                                    fnTest.test(prop[name])
                                ) {
                                prototype[name] = (function(name, fn){
                                    return function() {
                                        var tmp = this.parent;
                                        this.parent = parent[name];
                                        var ret = fn.apply(this, arguments);
                                        this.parent = tmp;
                                        return ret;
                                    };
                                })( name, prop[name] );
                            }
                            else {
                                prototype[name] = prop[name];
                            }
                        }
                        var ig = {
                            copy: function( object ) {
                                if(
                                    !object || typeof(object) != 'object' ||
                                        object instanceof HTMLElement ||
                                        //object instanceof ig.Class
                                        object instanceof Class
                                    ) {
                                    return object;
                                }
                                else if( object instanceof Array ) {
                                    var c = [];
                                    for( var i = 0, l = object.length; i < l; i++) {
                                        c[i] = ig.copy(object[i]);
                                    }
                                    return c;
                                }
                                else {
                                    var c = {};
                                    for( var i in object ) {
                                        c[i] = ig.copy(object[i]);
                                    }
                                    return c;
                                }
                            }
                        }

                        function Class() {
                            if( !initializing ) {

                                // If this class has a staticInstantiate method, invoke it
                                // and check if we got something back. If not, the normal
                                // constructor (init) is called.
                                if( this.staticInstantiate ) {
                                    var obj = this.staticInstantiate.apply(this, arguments);
                                    if( obj ) {
                                        return obj;
                                    }
                                }
                                for( var p in this ) {
                                    if( typeof(this[p]) == 'object' ) {
                                        this[p] = ig.copy(this[p]); // deep copy!
                                    }
                                }
                                if( this.init ) {
                                    this.init.apply(this, arguments);
                                }
                            }
                            return this;
                        }

                        Class.prototype = prototype;
                        Class.constructor = Class;
                        Class.extend = arguments.callee;
                        Class.inject = function(prop) {
                            var proto = this.prototype;
                            var parent = {};
                            for( var name in prop ) {
                                if(
                                    typeof(prop[name]) == "function" &&
                                        typeof(proto[name]) == "function" &&
                                        fnTest.test(prop[name])
                                    ) {
                                    parent[name] = proto[name]; // save original function
                                    proto[name] = (function(name, fn){
                                        return function() {
                                            var tmp = this.parent;
                                            this.parent = parent[name];
                                            var ret = fn.apply(this, arguments);
                                            this.parent = tmp;
                                            return ret;
                                        };
                                    })( name, prop[name] );
                                }
                                else {
                                    proto[name] = prop[name];
                                }
                            }
                        };

                        return Class;
                    };
                var EventClass = Class.extend({
                        events:{}
                        /*
                         缁戝畾浜嬩欢
                         */
                        ,bind:function(eventName,fireBack){
                            if('string' == typeof eventName){
                                var e = this.events[eventName];
                                if(!e){
                                    e = this.events[eventName] = [];
                                }
                                if('function' == typeof fireBack){
                                    e.push(fireBack);
                                }
                            }
                            return this;
                        }
                        /*
                         瑙ｉ櫎缁戝畾浜嬩欢
                         eventName:瑕佸垹闄ょ殑浜嬩欢鍚嶇О 濡傛灉涓嶆彁渚� 鍒欏垹闄よ鎵€鏈夌殑浜嬩欢鐩戝惉
                         ,fireBack:瑕佽Е鍙戠殑鏂规硶 濡傛灉娌℃湁璇ユ柟娉� 鍒欏垹闄よ浜嬩欢鎵€鏈夌殑缁戝畾
                         */
                        ,unBind:function(eventName, fireBack){
                            var me = this;
                            if(!eventName){
                                for(var ename in this.events){
                                    this.events[ename] = null;
                                }
                            }else{
                                if('function' != fireBack){
                                    this.events[eventName] = null;
                                }else{
                                    var e = this.events[eventName];
                                    if(e){
                                        for(var i = 0;i<e.length;i++){
                                            if(fireBack == e[i]){
                                                e.splice(i,1);
                                            }
                                        }
                                    }
                                }
                            }
                            return this;
                        }
                        /*
                         瑙﹀彂鍒跺畾鐨勪簨浠�
                         渚濈収缁戝畾鐨勬搴忚繘琛岃皟鐢�
                         浜嬩欢鍚嶇О鍚庨潰鍙互娣诲姞涓嶅畾闀跨殑鍙傛暟
                         */
                        ,fire:function(eventName){
                            var e = this.events[eventName];
                            var returnValue = false;
                            if(e){
                                var arg = null;
                                if(arguments.length>1){
                                    arg = [];
                                    for(var i=1;i<arguments.length;i++){
                                        arg.push(arguments[i]);
                                    }
                                }
                                for(var i=0;i<e.length;i++){
                                    var cb = e[i];
                                    if(arg?cb.apply(this,arg):cb.apply(this)){
                                        returnValue = true;
                                    }
                                }
                            }
                            return returnValue;
                        }

                    });

                var pushManager =  EventClass.extend({
                    events:{}
                   /*
                    缁戝畾浜嬩欢
                    */
                   ,bind:function(eventName,fireBack){
                       if('string' == typeof eventName){
                           var e = this.events[eventName];
                           if(!e){
                               e = this.events[eventName] = [];
                           }
                           if('function' == typeof fireBack){
                               e.push(fireBack);
                           }
                       }
                       return this;
                   }
                   /*
                    瑙ｉ櫎缁戝畾浜嬩欢
                    eventName:瑕佸垹闄ょ殑浜嬩欢鍚嶇О 濡傛灉涓嶆彁渚� 鍒欏垹闄よ鎵€鏈夌殑浜嬩欢鐩戝惉
                    ,fireBack:瑕佽Е鍙戠殑鏂规硶 濡傛灉娌℃湁璇ユ柟娉� 鍒欏垹闄よ浜嬩欢鎵€鏈夌殑缁戝畾
                    */
                   ,unBind:function(eventName, fireBack){
                       var me = this;
                       if(!eventName){
                           for(var ename in this.events){
                               this.events[ename] = null;
                           }
                       }else{
                           if('function' != fireBack){
                               this.events[eventName] = null;
                           }else{
                               var e = this.events[eventName];
                               if(e){
                                   for(var i = 0;i<e.length;i++){
                                       if(fireBack == e[i]){
                                           e.splice(i,1);
                                       }
                                   }
                               }
                           }
                       }
                       return this;
                   }
                   /*
                    瑙﹀彂鍒跺畾鐨勪簨浠�
                    渚濈収缁戝畾鐨勬搴忚繘琛岃皟鐢�
                    浜嬩欢鍚嶇О鍚庨潰鍙互娣诲姞涓嶅畾闀跨殑鍙傛暟
                    */
                   ,fire:function(eventName){
                       var e = this.events[eventName];
                       var returnValue = false;
                       if(e){
                           var arg = null;
                           if(arguments.length>1){
                               arg = [];
                               for(var i=1;i<arguments.length;i++){
                                   arg.push(arguments[i]);
                               }
                           }
                           for(var i=0;i<e.length;i++){
                               var cb = e[i];
                               if(arg?cb.apply(this,arg):cb.apply(this)){
                                   returnValue = true;
                               }
                           }
                       }
                       return returnValue;
                   }
                    ,pushid:null
                    ,pushmsg:[]
                    ,PUSH_ID:function(pushid){
                        this.pushid = pushid;
                        alert('pushid\n' + pushid);
                        this.fire('pushid');
                    }
                    ,PUSH_MSG:function(msg){
                        this.pushmsg.push(msg);
                        alert('pushmsg\n' + msg);
                        this.fire('pushmsg');
                    }
                    ,getPushid:function(){
                        return this.pushid;
                    }
                    ,getPushmsg:function(){
                        return this.pushmsg.shift();
                    }
                });


                window.PushManager = new pushManager({

                });

            })();


            //首先让window添加一个事件监听函数，表明它可以监听窗口对象的message事件
            //它受到事件时，会先判断是否来自指定的Domain(不是所有Domain丢过来的事件它都处理的）
            window.addEventListener("message",function(ev){
                console.log("the receiver callback func has been invoked");


                //现在可以处理数据了
                /**
                 *
                 * {t:in}
                 * {t:out}
                 * {pushid:xxxx}
                 *
                 *
                 *
                 *
                 */


                //控制台打印出接收到的json数据，因为我们把json字符串发送了过来
                console.log('getmessage',ev.data);

                //将json字符串转为json对象，然后从中分离出原始信息
                var personInfoJSON = JSON.parse(ev.data);

                if(personInfoJSON.pushid){      //当前是一个pushid推送
                    window.PushManager.PUSH_ID(personInfoJSON.pushid);
                }else if(personInfoJSON.t){         //当前是一个消息推送
                    window.PushManager.PUSH_MSG(ev.data);
                }
            });
        })();
</script>
<!--phonegap-->
<!--<script type="text/javascript" src="cordova.js"></script>-->
<!--<script type="text/javascript" src="js/index.js"></script>-->
<!--¥-->

</html>